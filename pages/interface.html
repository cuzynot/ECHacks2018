<!DOCTYPE HTML>
<html>
<title>Myst</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
	body,
	h1,
	h2,
	h3,
	h4,
	h5,
	h6 {
		font-family: "Raleway", sans-serif
	}

	body,
	html {
		height: 100%;
		line-height: 1.8;
	}

	/* Full height image header */
	.bgimg-1 {
		background-position: center;
		background-size: cover;
		background-image: url("h.jpg");
		min-height: 100%;
	}

	.w3-bar .w3-button {
		padding: 15px;
	}
</style>

<body>


	<!-- Navbar (sit on top) -->
	<div class="w3-top">
		<div class="w3-bar w3-white w3-card" id="myNavbar">
			<a href="site.html" class="w3-bar-item w3-button w3-wide">LOGO</a>
			<!-- Right-sided navbar links -->
			<div class="w3-right w3-hide-small">
				<a href="#about" class="w3-bar-item w3-button">ABOUT</a>
				<a href="#team" class="w3-bar-item w3-button"><i class="fa fa-user"></i> TEAM</a>
				<a href="localhost:1337" class="w3-bar-item w3-button"><i class="fa fa-th"></i> MYST CONTROL CENTRE</a>

				<a href="#contact" class="w3-bar-item w3-button"><i class="fa fa-envelope"></i> CONTACT</a>
			</div>
			<!-- Hide right-floated links on small screens and replace them with a menu icon -->

			<a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" onclick="w3_open()">
				<i class="fa fa-bars"></i>
			</a>
		</div>
	</div>

	<head>
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
		<style>
			body {
				margin: 0px;
				padding: 0px;
			}

			#sData {
				float: left;
				margin-left: 200px;
				margin-right: auto;
				width: 1000px;
			}

			#rData {
				float: left;
				margin-left: 80px;
				margin-right: auto;
				width: 470px;
				padding: 20px;
			}

			h2 {
				text-align: center;
			}

			#btnHolder,
			#sliderTxt {
				text-align: center;
			}

			#myCanvas {
				border: 2px solid darkblue;
			}
		</style>
		<script src="http://code.jquery.com/jquery-1.8.3.js"></script>
		<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script>

			// variables
			var gx = 0;
			var gy = 0;
			var temps = [];
			var humis = [];
			var airqs = [];

			var iosocket;
			var text;
			var toggleVal = 0;
			var canvas, content;
			var temp, humi, airq;
			var ctx, c;

			// canvas request for all browsers
			window.requestAnimFrame = (function (callback) {
				return window.requestAnimationFrame ||
					window.webkitRequestAnimationFrame ||
					window.mozRequestAnimationFrame ||
					window.oRequestAnimationFrame ||
					window.msRequestAnimationFrame ||
					function (callback) {
						window.setTimeout(callback, 1000 / 30); // 30 frames per second
					};
			})();

			function animation(poll1, text) {
				canvas = document.getElementById("myCanvas");
				content = canvas.getContext("2d");
				// clear canvas
				// content.clearRect(0, 0, 460, 540);

				content.fillStyle = 'black';
				content.textAlign = 'center';
				content.font = '50pt Calibri';
				updateText();
			}

			function initSocketIO() {
				canvas = document.getElementById("myCanvas");
				canvas.width = 1200;
				canvas.height = 600;
				// canvas.style.width = 4800;
				// canvas.style.height = 2400;

				content = canvas.getContext("2d");
				// loading
				content.fillText('Loading...', 550, 300);
				iosocket = io.connect();
				iosocket.on('onconnection', function (value) {
					console.log("IOSOCKET ON");
					console.log("received " + value + " - onconnection");
					// initPoll();
					initButton();
					initSlider();

					// receive changed values by other client from server
					iosocket.on('updateData', function (receivedData) {
						if (receivedData.charAt(0) == 'T') {
							temp = parseInt(receivedData.substring(1));
							if (temp > 200) {
								temp -= 200;
								console.log("temptemp " + temp);
							}
							temps.push(temp);
						} else if (receivedData.charAt(0) == 'H') {
							humi = parseInt(receivedData.substring(1));
							humis.push(humi);
						} else if (receivedData.charAt(0) == 'A') {
							airq = parseInt(receivedData.substring(1));
							airqs.push(airq);
						}

						// clear canvas
						content.clearRect(0, 0, 1200, 540);
						updateText();

						if (humis.length == humis.length && humis.length == airqs.length) {
							updateGraph();
						}
					});
				});
			}
			function initPoll() {
				// animation(poll1,text);
			}

			function initButton() {
				$("#check").button();
			}

			function initSlider() {
				$("#slider").slider({
					min: 0,
					max: 100,
					change: function (event, ui) {
						iosocket.emit('sliderval', ui.value);
						document.getElementById('sliderValue').innerHTML = ui.value;
					}
				});
			}

			window.onload = function () {
				initSocketIO();
			};

			function updateText() {
				if (toggleVal == 0) {
					content.fillStyle = "#a4150b"; // red
					content.fillText("Off", 50, 50);
				} else {
					content.fillStyle = "#28d031"; // green
					content.fillText("On", 50, 50);
				}
				content.fillStyle = "#fac152"; // yellow
				content.fillText('Temperature: ' + temp, 50, 100);

				content.fillStyle = "#a1d0ed"; // blue
				content.fillText('Humidity: ' + humi, 50, 150);

				content.fillStyle = "#2e3843"; // gray
				content.fillText('Air Quality: ' + airq, 50, 200);
			}

			function updateGraph() {
				// draw temperature
				ctx.strokeStyle = "#fac152"; // yellow
				ctx.beginPath();
				for (var i = 0; i < temps.length; i++) {
					ctx.lineTo(i * 10, 300 - temps[i] * 4);
				}
				ctx.stroke();

				// draw humidity
				ctx.strokeStyle = "#a1d0ed"; // blue
				ctx.beginPath();
				for (var i = 0; i < humis.length; i++) {
					ctx.lineTo(i * 10, 600 - humis[i] * 6);
				}
				ctx.stroke();

				// draw air quality
				ctx.strokeStyle = "#2e3843"; // gray
				ctx.beginPath();
				for (var i = 0; i < airqs.length; i++) {
					ctx.lineTo(i * 10, 300 - airqs[i] / 10);
				}
				ctx.stroke();
			}
			$(document).ready(function () {
				$('#btnid').click(function () {
					toggleVal += 1;
					toggleVal %= 2;
					iosocket.emit('buttonval', toggleVal);
				});
				c = document.getElementById('myCanvas');
				ctx = c.getContext("2d");
			});
		</script>



	<body>
		<div id="chartContainer" style="height: 300px; width: 100%;"></div>
		<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
	</body>

	</head>

	<body>
		<div id="sData">
			<h2 id="header">MYST CONTROL CENTRE</h2>
			<div id="btnHolder">
				<button id="btnid" class="btn info"> On/Off</button>
			</div>
			<p id="sliderTxt">Desired Humidity</p>
			<div id="slider" class="sld"></div>
			<div id="sliderValue">0</div>
		</div>
		<div id="rData">
			<canvas id="myCanvas"></canvas>
		</div>

		<style>
			/* text css */
			#header {
				color: skyblue;
			}

			/* button css */
			.btn {
				border: none;
				background-color: inherit;
				padding: 10px 20px;
				font-size: 16px;
				cursor: pointer;
				display: inline-block;
			}

			/* Blue */
			.info {
				color: dodgerblue;
			}

			.info:hover {
				background: #2196F3;
				color: white;
			}

			.default:hover {
				background: #e7e7e7;
			}

			/* slider css
			.sld {
				-webkit-appearance: none;
				width: 100%;
				background: #d3d3d3;
				outline: none;
				opacity: 0.7;
				-webkit-transition: .2s;
				transition: opacity .2s;
			}

			.sld:hover {
				opacity: 1;
			}

			.sld::-webkit-slider-thumb {
				-webkit-appearance: none;
				appearance: none;
				width: 25px;
				height: 25px;
				background: #4CAF50;
				cursor: pointer;
			}

			.sld::-moz-range-thumb {
				width: 25px;
				height: 25px;
				background: #4CAF50;
				cursor: pointer;
			} */
		</style>
	</body>

</html>