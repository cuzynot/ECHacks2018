<!DOCTYPE HTML>
<html>
<title>Myst</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Raleway", sans-serif}
body, html {
	height: 100%;
	line-height: 1.8;
}
/* Full height image header */
.bgimg-1 {
	background-position: center;
	background-size: cover;
	background-image: url("h.jpg");
	min-height: 100%;
}
.w3-bar .w3-button {
	padding: 16px;
}
</style>
<body>

	<!-- Navbar (sit on top) -->
	<div class="w3-top">
		<div class="w3-bar w3-white w3-card" id="myNavbar">
			<a href="site.html" class="w3-bar-item w3-button w3-wide">LOGO</a>
			<!-- Right-sided navbar links -->
			<div class="w3-right w3-hide-small">
				<a href="#about" class="w3-bar-item w3-button">ABOUT</a>
				<a href="#team" class="w3-bar-item w3-button"><i class="fa fa-user"></i> TEAM</a>
				<a href="localhost:1337" class="w3-bar-item w3-button"><i class="fa fa-th"></i> OUR SERVICE</a>

				<a href="#contact" class="w3-bar-item w3-button"><i class="fa fa-envelope"></i> CONTACT</a>
			</div>
			<!-- Hide right-floated links on small screens and replace them with a menu icon -->

			<a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" onclick="w3_open()">
				<i class="fa fa-bars"></i>
			</a>
		</div>
	</div>
	<head>    
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
		<style>
		body {
			margin: 0px;
			padding: 0px;
		}
		#rData{
			float:left;
			margin-left:100px;
			margin-right:auto;
			width:470px;
		}
		#sData{
			float: left;
			margin-left:100px;
			margin-right:auto;
			width:470px;
		}
		h2{
			text-align:center;
		}
		#myCanvas {
			border: 2px dashed grey;
		}
		#btnHolder, #sliderTxt{
			text-align:center;
		}
	</style>
	<script src="http://code.jquery.com/jquery-1.8.3.js"></script>
	<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
	// canvas request for all browsers
	window.requestAnimFrame = (function(callback) {
		return window.requestAnimationFrame || 
		window.webkitRequestAnimationFrame || 
		window.mozRequestAnimationFrame || 
		window.oRequestAnimationFrame || 
		window.msRequestAnimationFrame ||
		function(callback) {
          window.setTimeout(callback, 1000 / 30); // 30 frames per second
      };
  })();

  var iosocket;
  var pollOneH = 0;
  var poll1;
  var text;
  var potValue;
  var prevPotValue;
  //var onOff = false; 
  var toggleVal = 0;

  function animation(poll1,text) {
  	var canvas = document.getElementById("myCanvas");
  	var content = canvas.getContext("2d");

	  // clear canvas
	  // content.clearRect(0, 0, 460, 540);
	  
	  content.fillStyle = 'black';
	  content.textAlign = 'center';
	  content.font = '20pt Calibri';
	  
	  // make the wobbely values stop 
	  if(pollOneH*2 > prevPotValue+2 || pollOneH*2 < prevPotValue-2){
	  	prevPotValue = potValue;
	  	potValue = pollOneH*2;
	  }

	  content.fillText('temperature: ' + potValue, text.x, text.y);

          // render graph 
          // content.fillStyle = 'orange';
          // content.fillRect(poll1.x,(poll1.y-poll1.h),poll1.w,poll1.h);

          // content.fill();

	  // request new frame
	  requestAnimFrame(function() {
	  	if(poll1.h < pollOneH){
	  		poll1.h += (pollOneH - poll1.h)*.15;
	  	}
	  	else if(poll1.h > pollOneH){
	  		poll1.h -= (poll1.h - pollOneH)*.15;
	  	}
	  	text.y = (poll1.y - poll1.h) - 5;
	  	animation(poll1,text);
	  });
	}

	function initSocketIO() {
		iosocket = io.connect();
		iosocket.on('onconnection', function(value) {
			console.log("IOSOCKET ON");
			console.log("received " + value + " - onconnection");
			pollOneH = value.pollOneValue/2; // recieve start poll value from server
			initPoll();
			initButton();
			initSlider();

			// recieve changed values by other client from server
			iosocket.on('updateData', function (recievedData) {
				console.log("received " + recievedData + " - updateData");
				pollOneH = recievedData.pollOneValue/2; // recieve start poll value from server

				// var content = canvas.getContext("2d");
				// content.fillText('temperature: ' + potValue, text.x, text.y);
			});
		});
	}

	function initPoll() {
		poll1 = {
			x: 10,
			y: 540,
			w: 440,
			h: 0
		}
		text = {
			x:poll1.w/2,
			y:100
		}
		potValue = pollOneH*2;
		prevPotValue = potValue;
		animation(poll1,text);
	}
	
	function initButton(){
		$( "#check" ).button();
	}
	
	function initSlider() {
		$( "#slider" ).slider({
			min:0,
			max:100,
			change: function(event,ui) {
				iosocket.emit('sliderval',ui.value);
				document.getElementById('sliderValue').innerHTML = ui.value;
			}
		});
	}
	
	window.onload = function() {
		initSocketIO();
	};

	var ctx, c;

	var datapoints = [
		{x: 0, y: 100},
		{x: 100, y: 120},
		{x: 250, y: 320},
		{x: 320, y: 270},
		{x: 460, y: 200},
	];

	function updateGraph() {
		ctx.clearRect(0, 0, c.width, c.height);
		ctx.beginPath();

		ctx.moveTo(datapoints[0].x, datapoints[0].y);

		for (var i = 1; i<datapoints.length; i++) {
			ctx.lineTo(datapoints[i].x, datapoints[i].y);
		}

		ctx.stroke();
	}

	$(document).ready(function() {
		$('#check').click(function() {
			toggleVal += 1;
			toggleVal %= 2;
			iosocket.emit('buttonval',toggleVal);
		});

		c = document.getElementById('myCanvas');
		ctx=c.getContext("2d");

		updateGraph();
	});
</script>



<body>
	<div id="chartContainer" style="height: 300px; width: 100%;"></div>
	<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>

</head>
<body>
	<div id="rData">
		
		<canvas id="myCanvas" width="460" height="540"></canvas>
	</div>
	<div id="sData">
		<h2>Data to Arduino</h2>
		<div id="btnHolder">
			<button id="check">On/Off</button>
		</div>
		<p id="sliderTxt">Humidity</p>
		<div id="slider"></div>
		Range
		<div id="sliderValue">0</div>
	</div> 
</body>
</html>